<%- include('../partials/head.ejs', { title }) %>
<%- include('../partials/header.ejs') %>
<%- include('../partials/nav.ejs', { nav }) %>

<main id="main" class="container" tabindex="-1">
  <h1><%= title %></h1>

  <!-- Flash messages -->
  <%- messages() %>

  <!-- Validation errors -->
  <% if (Array.isArray(errors) && errors.length) { %>
    <div class="notice" role="alert" aria-live="polite" style="margin:.75rem 0;">
      <ul class="errors" style="margin:.25rem 0 .25rem 1rem;">
        <% errors.forEach(e => { %>
          <li><%= e.msg %></li>
        <% }) %>
      </ul>
    </div>
  <% } %>

  <form class="form" action="/account/register" method="post" novalidate>
    <div class="form-row">
      <label for="account_firstname">First name</label>
      <input
        id="account_firstname"
        name="account_firstname"
        type="text"
        autocomplete="given-name"
        required
        placeholder="Tony"
        value="<%= account_firstname || '' %>"
      />
    </div>

    <div class="form-row">
      <label for="account_lastname">Last name</label>
      <input
        id="account_lastname"
        name="account_lastname"
        type="text"
        autocomplete="family-name"
        required
        placeholder="Stark"
        value="<%= account_lastname || '' %>"
      />
    </div>

    <div class="form-row">
      <label for="account_email">Email</label>
      <input
        id="account_email"
        name="account_email"
        type="email"
        inputmode="email"
        autocomplete="email"
        required
        placeholder="you@example.com"
        value="<%= account_email || '' %>"
      />
    </div>

    <div class="form-row">
      <label for="account_password">Password</label>
      <input
        id="account_password"
        name="account_password"
        type="password"
        autocomplete="new-password"
        minlength="12"
        required
        placeholder="Create a strong password"
        aria-describedby="pwd-hint"
      />
      <p class="form-hint" id="pwd-hint">
        Must be at least <strong>12</strong> characters and include
        <strong>1 uppercase</strong>, <strong>1 number</strong>, and
        <strong>1 special</strong> character.
      </p>

      <button class="btn outline" type="button" id="togglePwd" aria-controls="account_password" aria-pressed="false">
        Show password
      </button>
    </div>

    <button class="btn primary" type="submit">Create account</button>
  </form>

  <p style="margin-top:.75rem">
    Already have an account?
    <a href="/account/login">Sign in</a>.
  </p>
</main>

<script>
  (function () {
    const btn = document.getElementById('togglePwd');
    const input = document.getElementById('account_password');
    if (!btn || !input) return;
    btn.addEventListener('click', () => {
      const showing = input.type === 'text';
      input.type = showing ? 'password' : 'text';
      btn.textContent = showing ? 'Show password' : 'Hide password';
      btn.setAttribute('aria-pressed', String(!showing));
    });
  })();
</script>

<%- include('../partials/footer.ejs') %>
